@startuml

entity "User" as User {
  * user_id : UUID
  --
  * email : String
  * password_hash : String
  * name : String
  * created_at : DateTime
  * updated_at : DateTime
}

entity "Session" as Session {
  * session_id : UUID
  --
  * user_id : UUID
  * token_hash : String
  * created_at : DateTime
  * expires_at : DateTime?
  * revoked_at : DateTime?
}

entity "Location" as Location {
  * location_id : UUID
  --
  * user_id : UUID
  * name : String
  * description : String
  * longitude : Decimal
  * latitude : Decimal
  * created_at : DateTime
  * updated_at : DateTime
  * deleted_at : DateTime?
}

entity "Device" as Device {
  * device_id : UUID
  --
  * location_id : UUID
  * device_type : enum
  * status : enum
  * name : String
  * description : String
  * created_at : DateTime
  * updated_at : DateTime
  * deleted_at : DateTime?
}

entity "DeviceConfiguration" as DeviceConfiguration {
    * config_id : UUID
    --
    * device_id : UUID
    * data : JSON
    * created_at : DateTime
    * updated_at : DateTime
    * deleted_at : DateTime?
}

entity "Scenario" as Scenario {
    * scenario_id : UUID
    --
    * user_id : UUID
    * name : String
    * description : String
    * is_active : Boolean
    * created_at : DateTime
    * updated_at : DateTime
    * deleted_at : DateTime?
}

entity "ScenarioDevice" as ScenarioDevice {
    * id : UUID
    --
    * scenario_id : UUID
    * device_id : UUID
    * role : enum (trigger, action)
    * config : JSON
    * created_at : DateTime
    * updated_at : DateTime
    * deleted_at : DateTime?
}

entity "TelemetryEvent" as TelemetryEvent {
    * event_id : UUID
    --
    * device_id : UUID
    * event_type : String
    * data : JSON
    * dt : DateTime
}

' User
User ||--o{ Session : "has"
User ||--o{ Location : "owns"
User ||--o{ Scenario : "owns"

' Location -> Device
Location ||--o{ Device : "contains"

' Device
Device ||--|| DeviceConfiguration : "has"
Device ||--o{ TelemetryEvent : "emits"
Device ||--o{ ScenarioDevice : "used in"

' Scenario -> Device (N:M через ScenarioDevice)
Scenario ||--o{ ScenarioDevice : "uses"

@enduml
